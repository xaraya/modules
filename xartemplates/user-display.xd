<xar:template xmlns:xar="http://xaraya.com/2004/blocklayout">
    <div class="xar-mod-head">
        <span class="xar-mod-title"><xar:mlstring>Private Messages</xar:mlstring></span>
    </div>
    <div class="xar-mod-body">
        <xar:if condition="!isset($error)">
            <xar:template type="module" file="user-menu" />
            <table cellspacing="0" cellpadding="0" width="50%" border="0">
                <tr>
                    <td nowrap="nowrap" width="5%" align="center">
                        <xar:if condition="$unread gt 0">
                            <img src="#xarTplGetImage('green.gif','messages')#" />
                        <xar:else/>
                            <img src="#xarTplGetImage('red.gif','messages')#" />
                        </xar:if>
                    </td>
                    <td nowrap="nowrap" width="15%" align="right">
                        <xar:mlstring>Inbox</xar:mlstring>
                    </td>
                    <td nowrap="nowrap" width="10%"></td>
                    <td nowrap="nowrap" width="70%" align="left"> #$unread# / #$total# </td>
                </tr>
                <tr>
                    <td nowrap="nowrap" width="5%" align="center">

                    <xar:if condition="$sent gt 0">
                        <img src="#xarTplGetImage('green.gif','messages')#" />
                    <xar:else/>
                        <img src="#xarTplGetImage('red.gif','messages')#" />
                    </xar:if>
                    </td>
                    <td nowrap="nowrap" width="15%" align="right">
                        <xar:mlstring>Sent</xar:mlstring>
                    </td>
                    <td nowrap="nowrap" width="10%"></td>
                    <td nowrap="nowrap" width="70%" align="left">
                        #$sent#
                    </td>
                    </tr>
            <xar:comment>
                <tr>
                    <td nowrap="nowrap" width="5%" align="center">
                        *
                    </td>
                    <td nowrap="nowrap" width="15%" align="right">
                        <xar:mlstring>Drafts</xar:mlstring>
                    </td>
                    <td nowrap="nowrap" width="10%"></td>
                    <td nowrap="nowrap" width="70%" align="left">
                        #$total#
                    </td>
                </tr>
            </xar:comment>
            </table>
            <hr/>
            <div align="right">
               <br />
            </div>
            <table cellspacing="0" cellpadding="0" width="100%" border="0">
                <tr>
                    <th nowrap="nowrap" width="3%" align="center">
                        <img src="#$header_attachment_image#" alt="attachent" valign="bottom" />
                    </th>
                    <th nowrap="nowrap" width="3%" align="center">
                        <img src="#$header_status_image#" alt="attachent" valign="bottom" />
                    </th>
                    <th nowrap="nowrap" width="15%" align="left">
                        <xar:mlstring>From</xar:mlstring>
                    </th>
                    <th nowrap="nowrap" width="50%" align="center">
                        <xar:mlstring>Subject</xar:mlstring>
                    </th>
                    <th nowrap="nowrap" width="15%" align="center">
                        <xar:mlstring>Date</xar:mlstring>
                    </th>
                    <th nowrap="nowrap" width="10%" align="center">
                        <xar:mlstring>Action</xar:mlstring>
                    </th>
                </tr>
                <xar:if condition="xarSecurityCheck('DeleteMessages', 0)">
                    <xar:set name="allowdelete">1</xar:set>
                <xar:else/>
                    <xar:set name="allowdelete">0</xar:set>
                </xar:if>
                <xar:loop name="$messages">
                    <xar:if condition="(($loop:index + 1) % 2)">
                        <tr valign="center">
                            <td class="xar-norm" nowrap="nowrap">
                                <xar:comment> TODO: check for attachements </xar:comment>
                            </td>
                            <td class="xar-norm">
                                <img src="#$loop:item['status_image']#" alt="#$loop:item['status_alt']#" />
                            </td>
                            <td class="xar-norm" nowrap="nowrap" align="left">
                                <a href="#$loop:item['user_link']#" title="#xarML('View user info')#">#$loop:item['sender']#</a>
                            </td>
                            <td class="xar-norm" nowrap="nowrap" align="left">
                                &#160;|&#160;<a href="#$loop:item['view_link']#">#xarVarPrepForDisplay($loop:item['subject'])#</a>
                            </td>
                            <td class="xar-norm" nowrap="nowrap" align="left">
                                &#160;|&#160;#xarLocaleFormatDate('%A, %B %d @ %H:%M:%S', $loop:item['raw_date'])#
                            </td>
                            <td class="xar-norm" nowrap="nowrap" align="right">
                                &#160;|&#160;<a href="#$loop:item['view_link']#" title="#xarML('View message')#"><xar:mlstring>View</xar:mlstring></a> |
                                <a href="#$loop:item['reply_link']#" title="#xarML('Reply to Message')#"><xar:mlstring>Reply</xar:mlstring></a> |
                                <xar:if condition="!empty($allowdelete)">
                                    <a href="#$loop:item['delete_link']#" title="#xarML('Delete Message')#"><xar:mlstring>Delete</xar:mlstring></a>
                                <xar:else/>
                                    <xar:mlstring>Delete</xar:mlstring>
                                </xar:if>
                            </td>
                        </tr>
                    <xar:else />
                        <tr valign="center">
                            <td class="xar-accent" nowrap="nowrap">
                                <xar:comment> TODO: check for attachements </xar:comment>
                            </td>
                            <td class="xar-accent">
                                <img src="#$loop:item['status_image']#" alt="#$loop:item['status_alt']#" />
                            </td>
                            <td class="xar-accent" nowrap="nowrap" align="left">
                                <a href="#$loop:item['user_link']#" title="#xarML('View user info')#">#$loop:item['sender']#</a>
                            </td>
                            <td class="xar-accent" nowrap="nowrap" align="left">
                                &#160;|&#160;<a href="#$loop:item['view_link']#">#xarVarPrepForDisplay($loop:item['subject'])#</a>
                            </td>
                            <td class="xar-accent" nowrap="nowrap" align="left">
                                &#160;|&#160;#xarLocaleFormatDate('%A, %B %d @ %H:%M:%S', $loop:item['raw_date'])#
                            </td>
                            <td class="xar-accent" nowrap="nowrap" align="right">
                                &#160;|&#160;<a href="#$loop:item['view_link']#" title="#xarML('View message')#"><xar:mlstring>View</xar:mlstring></a> |
                                <a href="#$loop:item['reply_link']#" title="#xarML('Reply to Message')#"><xar:mlstring>Reply</xar:mlstring></a> |
                                <xar:if condition="!empty($allowdelete)">
                                    <a href="#$loop:item['delete_link']#" title="#xarML('Delete Message')#"><xar:mlstring>Delete</xar:mlstring></a>
                                <xar:else/>
                                    <xar:mlstring>Delete</xar:mlstring>
                                </xar:if>
                            </td>
                        </tr>
                    </xar:if>
                </xar:loop>
            </table>
                <hr/>
                <div align="right">
                    <a href="#xarModURL('messages','user','send',array('action'=>'post'))#">
                        <img src="#xarTplGetImage('newpm.gif','messages')#" border="0"/>
                    </a>
                </div>

            <xar:if condition="empty($away_message)">
                <span class="xar-mod-title"><xar:mlstring>Away Message - OFF</xar:mlstring></span>
            <xar:else/>
                <span class="xar-mod-title"><xar:mlstring>Away Message - ON</xar:mlstring></span>
            </xar:if>
            <form method="POST" action="&xar-modurl-messages-user-display;">
            <div class="xar-norm">
                <textarea cols="57" rows="4" name="away" id="away">#xarVarPrepForDisplay($away_message)#</textarea>
                <br/>
                <input type="submit" value="#xarML('Update')#" />
            </div>
            </form>
        <xar:else />
            <div class="xar-norm">
                #$error#
            </div>
        </xar:if>
    </div>
</xar:template>