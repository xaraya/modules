<xar:comment>License: GPL http://www.gnu.org/copyleft/gpl.html </xar:comment>
<div class="xar-julian xar-julian-user-year">
    <xar:template file="header" />

    <div class="xar-julian-cal">
        <div class="xar-julian-cal-nav">
            <div class="xar-julian-cal-nav-prev">
                <a href="#xarModAPIFunc('julian','user','prev',array('cal_type'=>'year','cal_date'=>$cal_date))#"
                   title="#xarML('Previous Year')#" class="arrow">&lt;&lt;</a>
            </div>
            <div class="xar-julian-cal-nav-next">
                <a href="#xarModAPIFunc('julian','user','next',array('cal_type'=>'year','cal_date'=>$cal_date))#"
                   title="#xarML('Next Year')#" class="arrow">&gt;&gt;</a>
            </div>
            <div class="xar-julian-cal-nav-current">
                <xar:set name="$theyear">xarLocaleFormatDate('%Y',$selected_timestamp)</xar:set>
                #$theyear#
            </div>
        </div>

        <div class="tables">
            <xar:comment>Number of columns calendars are displayed in.</xar:comment>
            <xar:set name="$xc_maxcols">3</xar:set>
            <xar:set name="$cols">1</xar:set>

            <table width="100%" cellpadding="0" cellspacing="0" border="0">
            <xar:comment>START :: LOOP THROUGH EACH MONTH OF THE YEAR</xar:comment>
            <xar:foreach in="$year" key="$month" value="$weeks">

            <xar:comment>start new row</xar:comment>
            <xar:if condition="$cols eq 1">
                <tr>
            </xar:if>
                    <td valign="top" align="left">

                        <table class="xar-julian-cal-month">
                            <tr>
                                <th colspan="8" class="xar-julian-cal-title">
                                    <xar:if condition="$month lt 10">
                                        <xar:set name="$month_2digit">"0".$month</xar:set>
                                    <xar:else />
                                        <xar:set name="$month_2digit">$month</xar:set>
                                    </xar:if>
                                    <xar:set name="$monthviewlink">$theyear.$month_2digit."01"</xar:set>
                                    <a href="#xarModURL('julian','user','month',array('cal_date'=>$monthviewlink))#">
                                        #xarModAPIFunc('julian','user','getMonthNameLong',array('month'=>$month))#
                                    </a>
                                </th>
                            </tr>
                            <tr class="xar-julian-cal-daynames">
                                <th>&nbsp;</th>
                                <xar:foreach in="$shortDayNames" value="$dayName">
                                <th>#$dayName#</th>
                                </xar:foreach>
                            </tr>
                            <xar:comment>START :: LOOP THROUGH EACH WEEK OF THE MONTH</xar:comment>
                            <xar:foreach in="$weeks" key="$index" value="$week">
                            <tr class="xar-julian-cal-week">
                                <xar:set name="$WeekDate">$week[0]</xar:set>
                                <xar:set name="$WeekUrl">xarModURL('julian','user','week',array('cal_date'=>$WeekDate))</xar:set>
                                <td class="xar-julian-cal-weeknumber">
                                    <a href="#$WeekUrl#" title="#xarML('Go to week')#" class="arrow">&gt;</a>
                                </td>
                                <xar:comment>START :: LOOP THROUGH EACH DAY OF THE WEEK</xar:comment>
                                <xar:foreach in="$week" value="$date">
                                <xar:comment>Color the cells differently for Sat and Sun</xar:comment>
                                <xar:if condition="$date eq xarLocaleFormatDate('%Y%m%d') && substr($date,4,2) eq $month">
                                    <xar:set name="$daycolor">"currentday"</xar:set>
                                <xar:elseif condition="$calendar:isWeekend($date)" />
                                    <xar:set name="$daycolor">"weekend"</xar:set>
                                <xar:else />
                                    <xar:set name="$daycolor">"weekday"</xar:set>
                                </xar:if>
                                <xar:if condition="substr($date,4,2) eq $month">
                                    <td class="day #$daycolor#">
                                        <xar:set name="dateconverted">date("Y-m-d",strtotime($date))</xar:set>
                                        <xar:comment>Add pop-over for event time and title</xar:comment>
                                        <xar:if condition="isset($event_array[$dateconverted])">
                                            <xar:set name="$text">'<span class="tt">'</xar:set>
                                            <xar:foreach in="$event_array[$dateconverted]" key="$index">
                                                <xar:set name="$text">$text.'<span>'.$event_array[$dateconverted][$index]['singlepopovercaption'].'</span>'</xar:set>
                                            </xar:foreach>
                                            <xar:set name="$text">$text.'</span>'</xar:set>
                                            <xar:set name="$event">'
                                             class="xar-julian-event"'</xar:set>
                                        <xar:else />
                                            <xar:set name="$text">''</xar:set>
                                            <xar:set name="$event">''</xar:set>
                                        </xar:if>
                                        <a href="#xarModURL('julian','user','day',array('cal_date'=>$date))#" #$event#>
                                            #$text#
                                            <xar:set name="$displayDay">substr($date,-2)</xar:set>
                                            #$displayDay#
                                        </a>
                                    </td>
                                <xar:else />
                                    <td class="day #$daycolor# empty">
                                        &nbsp;
                                    </td>
                                </xar:if>
                                </xar:foreach>
                                <xar:comment>END :: LOOP THROUGH EACH DAY OF THE WEEK</xar:comment>
                            </tr>
                            </xar:foreach>
                            <xar:comment>END :: LOOP THROUGH EACH WEEK OF THE MONTH</xar:comment>
                        </table>
                    </td>

            <xar:comment>close out row</xar:comment>
            <xar:if condition="$cols eq $xc_maxcols">
                </tr>
                <xar:set name="$cols">1</xar:set>
            <xar:else />
                <xar:set name="$cols">#$cols+1#</xar:set>
            </xar:if>
            </xar:foreach>
            <xar:comment>END :: LOOP THROUGH EACH MONTH OF THE YEAR</xar:comment>

            </table>
        </div>
    </div>

    <xar:comment>include the calendar footer</xar:comment>
    <xar:template file="footer" />
</div>
