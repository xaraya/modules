<xar:comment> License: GPL http://www.gnu.org/copyleft/gpl.html </xar:comment>

<xar:style scope="module" />
<xar:base-include-javascript module="base" filename="confirmlink.js" />

<xar:if condition="empty($tid) and empty($lid)">
    <xar:set name="title"><xar:mlstring>All List Types</xar:mlstring></xar:set>
</xar:if>
<xar:if condition="!empty($tid) and empty($lid)">
    <xar:set name="title"><xar:mlstring>List Type</xar:mlstring></xar:set>
</xar:if>
<xar:if condition="!empty($tid) and !empty($lid)">
    <xar:set name="title"><xar:mlstring>List</xar:mlstring></xar:set>
</xar:if>

<div class="xar-mod-head">
    <span class="xar-mod-title"><xar:mlstring>Lists Administration</xar:mlstring></span>
</div>
<div class="xar-mod-body">
    <h2><xar:mlstring>Lists Overview</xar:mlstring> - #$title#</h2>
    <div class="xar-mod-lists-view" style="margin: auto;">

        <xar:set name="label_view_list_types"><xar:mlstring>View list types</xar:mlstring></xar:set>
        <xar:set name="label_view_lists"><xar:mlstring>View lists</xar:mlstring></xar:set>
        <xar:set name="label_view_list_items"><xar:mlstring>View list items</xar:mlstring></xar:set>

        <xar:set name="label_edit_list_type"><xar:mlstring>Edit list type</xar:mlstring></xar:set>
        <xar:set name="label_edit_list"><xar:mlstring>Edit list</xar:mlstring></xar:set>
        <xar:set name="label_edit_list_item"><xar:mlstring>Edit list item</xar:mlstring></xar:set>

        <xar:set name="label_new_list_type"><xar:mlstring>New list type</xar:mlstring></xar:set>
        <xar:set name="label_new_list"><xar:mlstring>New list</xar:mlstring></xar:set>
        <xar:set name="label_new_list_item"><xar:mlstring>New list item</xar:mlstring></xar:set>

        <xar:set name="label_delete_list_type"><xar:mlstring>Delete list type</xar:mlstring></xar:set>
        <xar:set name="label_delete_list"><xar:mlstring>Delete list</xar:mlstring></xar:set>
        <xar:set name="label_delete_list_item"><xar:mlstring>Delete list item</xar:mlstring></xar:set>

        <xar:comment>
            Top level: no tid and no lid
            In here a user can:
            a) view an overview of the list types;
            b) create a new list type;
        </xar:comment>

        <p>
            [<a href="&xar-modurl-lists-admin-view;">#$label_view_list_types#</a>]
            [<a href="#$urlnew#" title="#$label_new_list_type#">#$label_new_list_type#</a>]
        </p>

        <xar:if condition="empty($tid)">
            <xar:if condition="$mode ne 'view'">
                <xar:if condition="$mode eq 'new' or $mode eq 'create'">
                    <xar:comment>Form for a new list type</xar:comment>
                    <ul class="new"><li><div class="xar-title">#$label_new_list_type#</div>
                    <form method="post" action="#xarModURL('lists','admin','view',array('mode'=>'create'))#" enctype="application/x-www-form-urlencoded">
                        <fieldset>
                            <legend><xar:mlstring>Create a new List Type</xar:mlstring></legend>
                            <xar:template file="form_type" />
                        </fieldset>
                        <div><input type="submit" value="#xarML('Submit')#" /></div>
                    </form>
                    </li></ul>
                </xar:if>
            <xar:else />
                <xar:if condition="count($types) gt 0">
                    <ul>
                        <xar:loop name="$types">
                            <li>
                                #$loop:item.tid#: #$loop:item.type_name#
                                [<a href="#$loop:item.urledit#" title="#$label_edit_list_type#">#$label_edit_list_type#</a>]
                                [<a href="#$loop:item.urlview#">#$label_view_lists#</a>]
                                [<a href="#$loop:item.urlnew#" title="#$label_new_list#">#$label_new_list#</a>]
                                <xar:if condition="!empty($loop:item.type_desc)">
                                    <br /><em>#xarVarPrepForDisplay($loop:item.type_desc)#</em>
                                </xar:if>
                            </li>
                        </xar:loop>
                    </ul>
                </xar:if>
            </xar:if>
        </xar:if>



        <xar:comment>
            Second level: a tid and no lid.
            In here a user can View the details of a list type, and one of:
            a) an overview of the lists for the type;
            b) create a new list for the type;
            c) edit an existing list type.
        </xar:comment>

        <xar:if condition="!empty($tid) and empty($lid)">
            <ul class="list-type">
                <li>
                    #$type.tid#: #$type.type_name#
                    [<a href="#$type.urledit#" title="#$label_edit_list_type#">#$label_edit_list_type#</a>]
                    [<a href="#$type.urlview#">#$label_view_lists#</a>]
                    [<a href="#$type.urlnew#" title="#$label_new_list#">#$label_new_list#</a>]
                    <xar:if condition="!empty($type.type_desc)">
                        <br /><em>#xarVarPrepForDisplay($type.type_desc)#</em>
                    </xar:if>
                    <xar:if condition="$mode ne 'view'">
                        <xar:if condition="$mode eq 'modify' or $mode eq 'update'">
                            <xar:comment>Edit form for a list type</xar:comment>
                            <ul class="edit"><li><div class="xar-title">#$label_edit_list_type#</div>
                            <form method="post" action="#xarModURL('lists','admin','view',array('mode'=>'update','tid'=>$type.tid))#" enctype="application/x-www-form-urlencoded">
                                <fieldset>
                                    <legend><xar:mlstring>Edit existing List Type</xar:mlstring></legend>
                                    <xar:template file="form_type" />
                                </fieldset>
                                <div class="xar-form-input-wrapper">
                                    <xar:if condition="$type.typehooks eq 'list'">
                                        [<a href="#xarServerGetCurrentURL(array('typehooks'=&gt;'item'))#"><xar:mlstring>Hooks for items</xar:mlstring></a>]
                                        | [<xar:mlstring>Hooks for lists</xar:mlstring>]
                                    <xar:else />
                                        [<xar:mlstring>Hooks for items</xar:mlstring>]
                                        | [<a href="#xarServerGetCurrentURL(array('typehooks'=&gt;'list'))#"><xar:mlstring>Hooks for lists</xar:mlstring></a>]
                                    </xar:if>
                                </div>
                                <xar:if condition="!empty($hooks_config) && is_array($hooks_config)">
                                    <xar:loop name="$hooks_config">
                                        #$loop:item#
                                    </xar:loop>
                                </xar:if>
                                <div class="xar-form-input-wrapper-after"><input type="submit" value="#xarML('Submit')#" /></div>
                            </form>
                            </li><ul>
                        </xar:if>
                        <xar:if condition="$mode eq 'new' or $mode eq 'create'">
                            <xar:comment>Form for a new list</xar:comment>
                            <ul class="new"><li><div class="xar-title">#$label_new_list#</div>
                            <form method="post" action="#xarModURL('lists','admin','view',array('tid'=>$tid,'mode'=>'create'))#" enctype="application/x-www-form-urlencoded">
                                <fieldset>
                                    <legend><xar:mlstring>Create new List</xar:mlstring></legend>
                                    <xar:template file="form_list" />
                                    <xar:if condition="!empty($hooks_new_dd)">
                                        #$hooks_new_dd#
                                    </xar:if>
                                </fieldset>
                                <xar:if condition="!empty($hooks_new)">
                                    #$hooks_new#
                                </xar:if>
                                <div><input type="submit" value="#xarML('Submit')#" /></div>
                            </form>
                            </li></ul>
                        </xar:if>
                    <xar:else />
                        <xar:comment>Display-only</xar:comment>
                        <xar:if condition="count($lists) gt 0">
                            <div class="xar-title"><xar:mlstring>Lists</xar:mlstring></div>
                            <ul>
                                <xar:loop name="$lists">
                                    <li>
                                        #$loop:item.lid#: #$loop:item.list_name#
                                        [<a href="#$loop:item.urledit#" title="#$label_edit_list#">#$label_edit_list#</a>]
                                        [<a href="#$loop:item.urlview#">#$label_view_list_items#</a>]
                                        [<a href="#$loop:item.urlnew#" title="#$label_new_list_item#">#$label_new_list_item#</a>]
                                        <xar:if condition="!empty($loop:item.type_desc)">
                                            <br /><em>#xarVarPrepForDisplay($loop:item.list_desc)#</em>
                                        </xar:if>
                                    </li>
                                </xar:loop>
                            </ul>
                        <xar:else />
                            <xar:comment>No lists for this list type</xar:comment>
                        </xar:if>
                    </xar:if>
                </li>
            </ul>
        </xar:if>


        <xar:comment>
            Third level: a tid and lid
            In here a user can view the details of a list, and one of:
            a) an overview of the items for the list;
            b) create a new item for the list;
            c) edit an existing list.
        </xar:comment>

        <xar:if condition="!empty($tid) and !empty($lid) and empty($iid)">
            <ul>
                <li>
                    #$type.tid#: #$type.type_name#
                    [<a href="#$type.urledit#" title="#$label_edit_list_type#">#$label_edit_list_type#</a>]
                    [<a href="#$type.urlview#">#$label_view_lists#</a>]
                    [<a href="#$type.urlnew#">#$label_new_list#</a>]
                    <xar:if condition="!empty($type.type_desc)">
                        <br /><em>#xarVarPrepForDisplay($type.type_desc)#</em>
                    </xar:if>
                    <ul>
                        <li>
                            #$list.lid#: #$list.list_name#
                            [<a href="#$list.urledit#" title="#$label_edit_list#">#$label_edit_list#</a>]
                            [<a href="#$list.urlview#">#$label_view_list_items#</a>]
                            [<a href="#$list.urlnew#" title="#$label_new_list_item#">#$label_new_list_item#</a>]
                            <xar:if condition="!empty($list.list_desc)">
                                <br /><em>#xarVarPrepForDisplay($list.list_desc)#</em>
                            </xar:if>
                            <xar:if condition="$mode ne 'view'">
                                <xar:if condition="$mode eq 'modify' or $mode eq 'update'">
                                    <xar:comment>Edit form for the list</xar:comment>
                                    <ul class="edit"><li><div class="xar-title">#$label_edit_list#</div>
                                    <form method="post" action="#xarModURL('lists','admin','view',array('lid'=>$lid,'mode'=>'update'))#" enctype="application/x-www-form-urlencoded">
                                        <fieldset>
                                            <legend><xar:mlstring>Edit existing List</xar:mlstring></legend>
                                            <xar:template file="form_list" />
                                            <xar:if condition="!empty($hooks_modify_dd)">
                                                #$hooks_modify_dd#
                                            </xar:if>
                                        </fieldset>
                                        <xar:if condition="!empty($hooks_modify)">
                                            #$hooks_modify#
                                        </xar:if>
                                        <div><input type="submit" value="#xarML('Submit')#" /></div>
                                    </form>
                                    </li></ul>
                                </xar:if>
                                <xar:if condition="$mode eq 'new' or $mode eq 'create'">
                                    <xar:comment>Create form for new list item</xar:comment>
                                    <ul class="new"><li><div class="xar-title">#$label_new_list_item#</div>
                                    <form method="post" action="#xarModURL('lists','admin','view',array('lid'=>$lid,'mode'=>'create'))#" enctype="application/x-www-form-urlencoded">
                                        <fieldset>
                                            <xar:template file="form_item" />
                                            <xar:if condition="!empty($hooks_new_dd)">
                                                #$hooks_new_dd#
                                            </xar:if>
                                        </fieldset>
                                        <xar:if condition="!empty($hooks_new)">
                                            #$hooks_new#
                                        </xar:if>
                                        <div>
                                            <label for="batch" title="Enter items in batch mode"><xar:mlstring>Batch mode</xar:mlstring></label>
                                            <xar:if condition="!empty($batch)">
                                                <input type="checkbox" name="batch" id="batch" value="1" checked="checked"/>
                                            <xar:else />
                                                <input type="checkbox" name="batch" id="batch" value="1"/>
                                            </xar:if>
                                        </div><br/>
                                        <div><input type="submit" value="#xarML('Submit')#" /></div>
                                    </form>
                                    </li></ul>
                                </xar:if>
                            <xar:else />
                                <xar:comment>Display-only list items</xar:comment>
                                <xar:if condition="count($items) gt 0">
                                    <div class="xar-title"><xar:mlstring>List items</xar:mlstring></div>
                                    <ul>
                                        <xar:loop name="$items">
                                            <li>
                                                #$loop:item.iid#:
                                                #xarVarPrepForDisplay($loop:item.item_code)# =
                                                #xarVarPrepForDisplay($loop:item.item_short_name)#
                                                [<a href="#$loop:item.urledit#" title="#$label_edit_list_item#">#$label_edit_list_item#</a>]
                                                [<a href="#$loop:item.urldelete#" title="#$label_edit_list_item#" onClick="return xar_base_confirmLink(this, '#xarML('Delete list item ').' '.xarVarPrepfordisplay($loop:item.item_short_name)#?')">#$label_delete_list_item#</a>]
                                                <xar:if condition="!empty($loop:item.item_long_name)">
                                                    <br /><em>#xarVarPrepForDisplay($loop:item.item_long_name)#</em>
                                                </xar:if>
                                                <xar:if condition="!empty($loop:item.item_desc)">
                                                    <br /><em>#xarVarPrepForDisplay($loop:item.item_desc)#</em>
                                                </xar:if>
                                            </li>
                                        </xar:loop>
                                    </ul>
                                </xar:if>
                            </xar:if>
                        </li>
                    </ul>
                </li>
            </ul>
        </xar:if>


        <xar:comment>
            Forth level: a tid, a lid and an iid
            In here a user can:
            a) view the details of a list item; or
            b) edit an existing list item.
        </xar:comment>

        <xar:if condition="!empty($tid) and !empty($lid) and !empty($iid)">
            <ul>
                <li>
                    #$type.tid#: #$type.type_name#
                    [<a href="#$type.urledit#" title="#$label_edit_list_type#">#$label_edit_list_type#</a>]
                    [<a href="#$type.urlview#">#$label_view_lists#</a>]
                    [<a href="#$type.urlnew#">#$label_new_list#</a>]
                    <xar:if condition="!empty($type.type_desc)">
                        <br /><em>#xarVarPrepForDisplay($type.type_desc)#</em>
                    </xar:if>
                    <ul>
                        <li>
                            #$list.lid#: #$list.list_name#
                            [<a href="#$list.urledit#" title="#$label_edit_list#">#$label_edit_list#</a>]
                            [<a href="#$list.urlview#">#$label_view_list_items#</a>]
                            [<a href="#$list.urlnew#" title="#$label_new_list_item#">#$label_new_list_item#</a>]
                            <xar:if condition="!empty($list.list_desc)">
                                <br /><em>#xarVarPrepForDisplay($list.list_desc)#</em>
                            </xar:if>
                            <ul>
                                <li>
                                #$item.iid#:
                                #xarVarPrepForDisplay($item.item_code)# =
                                #xarVarPrepForDisplay($item.item_short_name)#
                                [<a href="#$item.urledit#" title="#$label_edit_list_item#">#$label_edit_list_item#</a>]
                                <xar:if condition="!empty($item.item_long_name)">
                                    <br /><em>#xarVarPrepForDisplay($item.item_long_name)#</em>
                                </xar:if>
                                <xar:if condition="!empty($item.item_desc)">
                                    <br /><em>#xarVarPrepForDisplay($item.item_desc)#</em>
                                </xar:if>

                                <xar:if condition="$mode ne 'view'">
                                    <xar:if condition="$mode eq 'modify' or $mode eq 'update'">
                                        <xar:comment>Edit form for the list item</xar:comment>
                                        <ul class="edit">
                                            <li><div class="xar-title">#$label_edit_list_item#</div>
                                            <form method="post" action="#xarModURL('lists','admin','view',array('iid'=>$iid,'mode'=>'update'))#" enctype="application/x-www-form-urlencoded">
                                                <fieldset>
                                                    <legend><xar:mlstring>Edit existing List item</xar:mlstring></legend>
                                                    <xar:template file="form_item" />
                                                    <xar:if condition="!empty($hooks_modify_dd)">
                                                        #$hooks_modify_dd#
                                                    </xar:if>
                                                </fieldset>
                                                <xar:if condition="!empty($hooks_modify)">
                                                    #$hooks_modify#
                                                </xar:if>
                                                <div><input type="submit" value="#xarML('Submit')#" /></div>
                                            </form>
                                            </li>
                                        </ul>
                                    </xar:if>
                                    <xar:if condition="$mode eq 'delete'">
                                        <div>
                                            <xar:mlstring>Confirm delete of this item:</xar:mlstring>
                                            <a href="#$urlconfirm#"><xar:mlstring>Confirm</xar:mlstring></a>
                                        </div>
                                    </xar:if>
                                <xar:else />
                                    <xar:comment>Dislay-only list item : actually there is nothing at a lower level to show</xar:comment>
                                </xar:if>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </li>
            </ul>
        </xar:if>

        <!-- add the pager here -->
        <xar:comment>#$pager#</xar:comment>
    </div>
</div>
